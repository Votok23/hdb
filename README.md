# Домашнее задание к занятию "Базы данных, их типы" - Котов Г.И.




### Задание 1
Задание 1. СУБД

Кейс

Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для каждой предметной области.

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему?

1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков. СУБД должна гарантировать целостность и чёткую структуру данных.

1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы?

1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? СУБД должны быть гибкими и быстрыми.

1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать?

1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.

1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?

1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?


### Решение 1:
**1.1. Бюджетирование, отчёты, прогнозирование**
*   **Тип СУБД:** Реляционная СУБД (PostgreSQL, Microsoft SQL Server).
*   **Почему:** Идеальны для сложных запросов, агрегаций (аналитические отчёты) и транзакций, требующих гарантий целостности данных (ACID). Чёткая схема данных предотвращает ошибки.

**1.1.* Ускорение хеширования**
*   **API:** Для ускорения операций хеширования (например, при обработке больших объёмов данных для отчётов) лучше использовать специализированные API или библиотеки, например, **Intel IPP (Integrated Performance Primitives)** или использовать возможности GPU через **CUDA** (NVIDIA), если задача массовая и требует высокой параллелизации.

---

**1.2. Лендинги и CRM**
*   **Для лендингов:** Документоориентированная NoSQL СУБД (MongoDB, Couchbase). Быстрая запись данных о лидах с гибкой схемой (разные формы на лендингах).
*   **Для CRM:** Реляционная СУБД (PostgreSQL) или гибридный подход. Для CRM важна структура связей между лидами, сделками, клиентами, что хорошо ложится на реляционную модель.

**1.2.* Одна СУБД для обеих задач?**
*   **Да, можно.** Универсальная СУБД **PostgreSQL** справится с обеими задачами. Для лендингов можно использовать тип данных `JSONB` для гибкого хранения данных лидов, а для CRM использовать классические таблицы со строгой схемой. Это обеспечит консистентность данных в рамках одной системы.

---

**1.3. База знаний отдела контроля качества**
*   **Тип СУБД:** Графовая СУБД (Neo4j) или реляционная СУБД.
*   **Почему:** Графовая база идеально отобразит иерархическую структуру компании и связи между нормативами. Если структура простая и древовидная, с задачей справится и реляционная СУБД с таблицами типа `documents (id, parent_id, ...)`.

**1.3.* Использовать существующую СУБД?**
*   **Да.** Если в компании уже используется **PostgreSQL** (задача 1.1 или 1.2), для базы знаний можно создать отдельную схему (`schema`) с таблицами, отражающими иерархию документов и метаданные. Это упростит администрирование.

---

**1.4. Логистика и маршруты**
*   **Тип СУБД:** Графовая СУБД (Neo4j, Amazon Neptune).
*   **Почему:** Графовые базы созданы для работы со связями (объекты - точки доставки - маршруты). Алгоритмы поиска кратчайшего пути работают в них максимально эффективно.

**1.4.* Подключить отдел закупок?**
*   **Лучше связка СУБД.** Закупкам нужна реляционная СУБД для работы с заказами, поставщиками, прайсами. Их базу следует интегрировать с графовой СУБД логистов через API. Например, при создании заказа в системе закупок данные о точке доставки передаются в графовую СУБД для построения маршрута.

---

**1.5.* Одна СУБД для всех задач?**
*   **Теоретически да, практически нет.** Универсальных СУБД, идеально подходящих для всех типов нагрузок, не существует.
*   **Наименее плохой вариант:** **PostgreSQL**. Благодаря поддержке JSONB, рекурсивным запросам (для иерархий), расширениям (например, `pgRouting` для графовых задач) и надежным транзакциям, он может быть компромиссным решением для всех перечисленных задач, кроме, возможно, высоконагруженных задач логистики в реальном времени. Однако для максимальной эффективности лучше использовать специализированные СУБД.

**Итоговая рекомендация:** Использовать комбинацию **PostgreSQL** (для бюджетирования, CRM, базы знаний) и **графовой СУБД** (для логистики), связав их через API бэкенда.


### Задание 1 Транзакции
2.1. Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы транзакция завершилась успешно. Ориентируйтесь на шесть действий.

2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

Приведите ответ в свободной форме.

### Решение 2:

**2.1. Пошаговые действия для пополнения баланса**

Для успешного завершения транзакции пополнения счёта необходимо выполнить следующие действия в рамках транзакции СУБД (принцип ACID):

1.  **Начало транзакции.** (`BEGIN`)
2.  **Списание суммы** с банковской карты (или счета) пользователя.
3.  **Зачисление суммы** на баланс телефона.
4.  **Фиксация транзакции в журнале.** Запись о successfulой операции вносится в таблицу истории платежей (id пользователя, сумма, дата/время, статус "success").
5.  **Фиксация транзакции.** (`COMMIT`) Все изменения (шаги 2-4) окончательно применяются к базе данных.
6.  **Отправка уведомления** пользователю об successfulом пополнении (SMS, PUSH). *Это действие часто выполняется уже после коммита транзакции, чтобы не блокировать её выполнение в случае проблем с сервисом уведомлений.*

---

**2.1.* Действия при автоплатеже**

Процесс аналогичен, но добавляются этапы инициализации и проверок *до* основной транзакции:

1.  **Запуск по расписанию.** Система проверяет список подключенных автоплатежей на текущую дату.
2.  **Проверка условий.** Для каждого автоплатежа проверяется: активен ли он, достаточно ли средств на карте пользователя, не превышен ли лимит автоплатежа.
3.  **Уведомление о списании.** Пользователю отправляется предварительное уведомление (например, за день), что завтра будет списан автоплатёж.
4.  **Выполнение транзакции.** Выполняются шаги 1-6 из предыдущего пункта (начало транзакции, списание, зачисление, запись в историю, коммит, уведомление).
5.  **Обновление данных автоплатежа.** Если платёж successfulен, фиксируется дата последнего списания и планируется следующее.

### Задание 3:

Задание 3. SQL vs NoSQL
3.1. Напишите пять преимуществ SQL-систем по отношению к NoSQL.

3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

Приведите ответ в свободной форме.

### Решение 3:

**3.1. Пять преимуществ SQL перед NoSQL**

1.  **Стандартизация (SQL):** Единый структурированный язык запросов (SQL) упрощает разработку, обучение и миграцию между системами разных вендоров.
2.  **Гарантии целостности (ACID):** Полная поддержка транзакций (Atomicity, Consistency, Isolation, Durability) критична для финансовых операций, где важна точность и надёжность данных.
3.  **Жёсткая схема данных:** Чётко определённая структура таблиц, типов данных и связей предотвращает попадание в базу некорректных данных и облегчает валидацию.
4.  **Мощные возможности JOIN:** Удобный и эффективный механизм для объединения данных из нескольких таблиц, что идеально для сложных аналитических отчётов с агрегацией.
5.  **Зрелость и сообщество:** SQL-системы существуют десятилетиями, имеют огромное сообщество, проверенную документацию и надёжную экосистему инструментов.

---

**3.1.* Преимущества NewSQL**

NewSQL-системы (например, Google Spanner, CockroachDB) пытаются совместить лучшее из двух миров:

*   **Перед SQL:** Сохраняют преимущества SQL (ACID-транзакции, знакомый язык), но добавляют **горизонтальную масштабируемость** как у NoSQL, что решает главную проблему традиционных SQL-систем.
*   **Перед NoSQL:** Предлагают **строгую консистентность данных** и мощные транзакции в распределённой среде, в то время как многие NoSQL-системы жертвуют этим ради доступности и скорости (теорема CAP).

### Задание 4:

Задание 4. Кластеры
Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу выделено 1000 машин.

На основе какого критерия будете выбирать тип СУБД и какая модель распределённых вычислений здесь справится лучше всего и почему?

Приведите ответ в свободной форме.

### Решение 4:

**Критерий выбора СУБД:** Основным критерием будет способность системы эффективно **горизонтально масштабироваться** на 1000 машин, параллельно обрабатывая данные и вычисления.

**Лучшая модель распределённых вычислений:** **MapReduce** (или подобные парадигмы, как в Apache Spark).

**Почему MapReduce/Spark:**

1.  **Масштабируемость:** Модель идеально предназначена для распределения задачи на множество машин. Фаза "Map" распределяет вычисления по узлам кластера, а "Reduce" агрегирует результаты.
2.  **Отказоустойчивость:** Если одна или несколько машин из 1000 выйдут из строя, их задачи будут автоматически перераспределены на другие рабочие узлы.
3.  **Локализация данных:** Вычисления переносятся к данным (на те узлы, где данные хранятся), что минимизирует сетевой трафик и ускоряет обработку огромных объёмов информации.

**Тип СУБД:** Для таких задач лучше всего подходят **СУБД для больших данных (Big Data)**, построенные на этой модели, например, **Apache Hadoop** (HDFS + MapReduce) или, что более современно, **Apache Spark** (как обработчик поверх HDFS или других хранилищ). Эти системы специально созданы для работы в очень больших кластерах.`